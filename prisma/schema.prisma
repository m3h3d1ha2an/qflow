generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name            String
  email           String
  emailVerified   Boolean @default(false)
  image           String?
  username        String?
  displayUsername String?

  sessions     Session[]
  accounts     Account[]
  services     Service[]
  staff        Staff[]
  appointments Appointment[]

  @@unique([email])
  @@unique([username])
  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  expiresAt DateTime
  token     String
  ipAddress String?
  userAgent String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("sessions")
}

model Account {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("accounts")
}

model Verification {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  identifier String
  value      String
  expiresAt  DateTime

  @@index([identifier])
  @@map("verifications")
}

model Service {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name     String @db.VarChar(100)
  duration Int
  required String @db.VarChar(50)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  appointments Appointment[]

  @@unique([name, userId])
  @@index([required])
  @@map("services")
}

model Staff {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name     String      @db.VarChar(100)
  role     String      @db.VarChar(50)
  capacity Int         @default(5)
  status   StaffStatus @default(AVAILABLE)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  appointments Appointment[]

  @@index([role])
  @@map("staff")
}

enum StaffStatus {
  AVAILABLE
  ON_LEAVE
}

model Appointment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  customer String            @db.VarChar(100)
  datetime DateTime
  status   AppointmentStatus @default(SCHEDULED)

  assignedId String
  assigned   Staff  @relation(fields: [assignedId], references: [id], onDelete: Cascade)

  serviceId String
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([datetime])
  @@index([userId])
  @@index([assignedId])
  @@map("appointments")
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}
